!function(n){function e(){function n(n){n=n||{};var e=this;Object.keys(n).forEach(function(r){e[r]=n[r]})}function e(n){n=n||{},Object.keys(n).forEach(function(e){f[e]=n[e]})}function r(e,r){if(e instanceof ArrayBuffer)return e;"string"==typeof e&&n.stringBytes&&(e=n.stringBytes(e,r));var t=new ArrayBuffer(e.length),a=new Uint8Array(t,0,e.length);return a.set(e),t}function t(e,t,a,u){if(null===e)return null;var i=n.from(e);return a=a||{},u=u||[0],Object.keys(i.defaultOptions||{}).forEach(function(n){"undefined"==typeof a[n]&&(a[n]=i.defaultOptions[n])}),Object.keys(f).forEach(function(n){"undefined"==typeof a[n]&&(a[n]=f[n])}),i.unpack(r(t,a),a,u)}function a(e,r,t,a){if(null===e)return null;var u=n.from(e);return a=a||[],t=t||{},Object.keys(u.defaultOptions||{}).forEach(function(n){"undefined"==typeof t[n]&&(t[n]=u.defaultOptions[n])}),Object.keys(f).forEach(function(n){"undefined"==typeof t[n]&&(t[n]=f[n])}),u.pack(r,t,a),a}function u(n,e,r){if(n.length<=0)return n;var t=function(){var t=[];if([].push.apply(t,r),[].push.apply(t,arguments),t.length>=n.length)return n.apply(null,t);var a=u(n,e,t);return"function"==typeof e&&e(a,t),a};return t}function i(n){function e(n){if(null===n)return"null";if(!n)return n;if(n.namespace)return"number"===n.namespace?"'"+n.name+"'":n.args?n.namespace+"("+i.apply(null,n.args)+")":"'"+n.namespace+"'";if("function"==typeof n){if(!n.name)return n.namespace="$fn",n.namespace}else if("object"==typeof n){var r=new n.constructor;return Object.keys(n).forEach(function(t){r[t]=e(n[t])}),r}return n.name?"'"+n.name+"'":"string"==typeof n?"'"+n+"'":n}if(arguments.length>1){for(var r=[],t=0;t<arguments.length;t++)r.push(i(arguments[t]));return r.join()}return JSON.stringify(e(n)||"").replace(/"/g,"")}var c={};n.register=function(e,r){c[e]=r,n[e]||(n[e]=r)},n.def=n.register;var o=[function(n){for(var e={},r=n;"string"==typeof r;){if(e[r])return;r=c[r],e[r]=!0}return r}];n.pushPattern=function(n){o.push(n)},n.from=function(e){if(e instanceof n)return e;for(var r=-1,t=0;t<o.length;t++)if(r!==t){var a=o[t](e);if(a){if(a instanceof n)return a;e=a,r=t,t=0}}};var f={littleEndian:!0};return n.setDefaultOptions=e,n.arrayBufferFrom=r,n.unpack=t,n.pack=a,n.together=u,n.stringify=i,n.prototype.toString=function(){return i(this)},n}function r(){function n(n,e){var r;return"number"!==e&&null!==e&&(r=A.from(e)),new A({unpack:function(t,a,u){var i;if(i=r?A.unpack(r,t,a,u):e,0===i)return[];var c=[],o=A.from(n);if(o.array&&(a.littleEndian||1===o.size)){var f=u[0],s=null===i?t.byteLength-f:o.size*i,p=new ArrayBuffer(s),g=new o.array(p),y=new Uint8Array(p);return y.set(new Uint8Array(t,f,Math.min(s,t.byteLength-f))),[].push.apply(c,g),u[0]+=s,c}if(null===i)for(var l;u[0]<t.byteLength&&l!==u[0];)l=u[0],c.push(A.unpack(o,t,a,u));else for(var m=0;i>m;m++)c.push(A.unpack(o,t,a,u));return c},pack:function(t,a,u){var i=A.from(n);if(t||r){var c;if(r?(c=t?t.length:0,A.pack(r,c,a,u)):c=null===e?(t||[]).length:e,t&&c){if(i.array&&(a.littleEndian||1===i.size)){var o=i.size*c,f=new ArrayBuffer(o),s=new i.array(f);s.set(t.slice(0,c));var p=new Uint8Array(f);return void[].push.apply(u,p)}for(var g=0;c>g;g++)A.pack(i,(t||[])[g],a,u)}}},namespace:"array",args:arguments,size:"number"===e?itemSchema.size*e:void 0})}function r(n){return j(n,"uint8")}function t(n){return j(n,"uint16")}function a(n){return j(n,"uint32")}function u(n){return A.array("uint8",n)}function i(n){if(n instanceof A)return n;var e=Object.keys(n);return new A({unpack:function(r,t,a){var u=new n.constructor,i=t.$scope;return t.$scope={target:u,offsets:new n.constructor,schema:n},e.forEach(function(e){t.$scope.exit?u[e]=null:(t.$scope.offsets[e]=a[0],u[e]=A.unpack(n[e],r,t,a))}),t.$scope=i,u},pack:function(r,t,a){var u=t.$scope;t.$scope={target:r,offsets:new n.constructor,schema:n},e.every(function(e){return t.$scope.exit?!1:(t.$scope.offsets[e]=a.length,A.pack(n[e],r[e],t,a),!0)}),t.$scope=u},args:arguments,namespace:"object"})}function c(n,e){var r=Object.keys(n);return new A({unpack:function(t,a,u){var i=u[0],c={};return r.forEach(function(e){u[0]=i,c[e]=A.unpack(n[e],t,a,u)}),u[0]+=e,c},pack:function(t,a,u){var i=new ArrayBuffer(e),c=new Uint8Array(i);r.forEach(function(e){if("undefined"!=typeof t[e]){var r=[];A.pack(n[e],t[e],a,r),c.set(r)}}),[].push.apply(u,c)},size:e,args:arguments,namespace:"union"})}function o(n,e){if(e=A.from(e),n instanceof Array){var r={};n.forEach(function(n,e){r[n]=e}),n=r}var t=Object.keys(n);return new A({unpack:function(r,a,u){var i,c=A.unpack(e,r,a,u);return t.every(function(e){return n[e]===c?(i=e,!1):!0}),i||c},pack:function(r,a,u){if("number"==typeof r)return void A.pack(e,r,a,u);if(t.every(function(t){return t===r?(A.pack(e,n[t],a,u),!1):!0}))throw new Error('Not find enum "'+r+'".')},namespace:"enums",args:arguments})}function f(n){return/[\u0080-\uffff]/.test(n)?unescape(encodeURIComponent(n)):n}function s(n){return/[\u00c0-\u00df][\u0080-\u00bf]/.test(n)||/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/.test(n)?decodeURIComponent(escape(n)):n}function p(n,e){return e=e||{},e.browser||"undefined"==typeof Buffer?"function"==typeof TextEncoder?Array.from(new TextEncoder(e.encoding).encode(n)):f(n).split("").map(function(n){return n.charCodeAt()}):new Buffer(n,e.encoding||"utf8")}function g(n){var e=A.array("uint8",n);return new A({unpack:function(n,r,t){var a=A.unpack(e,n,r,t);return r.browser||"undefined"==typeof Buffer?"function"==typeof TextDecoder?new TextDecoder(r.encoding).decode(a):s(String.fromCharCode.apply(String,a)):new Buffer(a).toString(r.encoding)},pack:function(n,r,t){A.pack(e,p(n,r),r,t)},namespace:"string",args:arguments})}function y(n){return new A({unpack:function(e,r,t){var a;a=null===n?new Uint8Array(e,t[0]):A.unpack(A.bytes(n),e,r,t);for(var u=0;a[u];)u++;var i=A.unpack(A.string(u),a,r);return null===n&&(t[0]+=u+1),i},pack:function(e,r,t){var a=[0];[].unshift.apply(a,A.stringBytes(e,r)),A.pack(A.bytes(n),a,r,t)},namespace:"cstring",args:arguments})}function l(n,e){return new A({unpack:function(r,t,a){var u=t.$scope.target[n];return A.unpack(e(u),r,t,a)},pack:function(r,t,a){var u=t.$scope.target[n];A.pack(e(u),r,t,a)},namespace:"depend",args:arguments})}function m(n,e){return x(n,A.array(e))}function v(){return new A({unpack:function(n,e,r){return e.$scope.exit=!0,null},pack:function(n,e,r){e.$scope.exit=!0},namespace:"exit",args:arguments})}function h(n,e,r,t){var a=A.bytes(t);return new A({unpack:function(n,t,u){var i=e(A.unpack(a,n,t,u));return A.unpack(r,i,t)},pack:function(e,t,u){var i=n(A.pack(r,e,t));A.pack(a,i,t,u)},namespace:"parse",args:arguments})}function k(n,e){return new A({unpack:function(){return/string|number/.test(typeof n)?n+e:"function"==typeof n?n(e):e},pack:function(){},args:arguments,namespace:"virtual"})}function d(n,e){return new A({unpack:function(r,t,a){var u=t.$scope.target[n],i=A.from(e);return A.unpack(A.array(i,u),r,t,a)},pack:function(r,t,a){for(var u=t.$scope.schema[n],i=A.from(e),c=A.pack(u,r.length,t),o=t.$scope.offsets[n],f=0;f<c.length;f++)a[o+f]=c[f];A.pack(A.array(i,null),r,t,a)},namespace:"link",args:arguments})}function w(n,e){return C(n,A.array(e))}function b(n){var e={};return n.forEach(function(n){var r=A.from(n);if(r){var t=r.args[0];Object.keys(t).forEach(function(n){e[n]=t[n]})}}),A.object(e)}var A=e(),E={int8:{type:"Int8",size:1,alias:["shortint"],array:Int8Array},uint8:{type:"Uint8",size:1,alias:["byte"],array:Uint8Array},int16:{type:"Int16",size:2,alias:["smallint"],array:Int16Array},uint16:{type:"Uint16",size:2,alias:["word"],array:Uint16Array},int32:{type:"Int32",size:4,alias:["longint"],array:Int32Array},uint32:{type:"Uint32",size:4,alias:["longword"],array:Uint32Array},float32:{type:"Float32",size:4,alias:["single"],array:Float32Array},float64:{type:"Float64",size:8,alias:["double"],array:Float64Array}};Object.keys(E).forEach(function(n){var e=E[n],r=new A({unpack:function(n){return function(r,t,a){var u=a[0];a[0]+=e.size;var i;return i=r instanceof DataView?r:new DataView(r),i[n](u,t.littleEndian)}}("get"+e.type),pack:function(n){return function(r,t,a){var u=new ArrayBuffer(e.size),i=new DataView(u),c=new Uint8Array(u);i[n](0,r,t.littleEndian),[].push.apply(a,c)}}("set"+e.type),size:e.size,name:n,namespace:"number",array:e.array});A.register(n,r),(e.alias||[]).forEach(function(n){A.register(n,r)})});var j=A.together(n,function(n,e){n.namespace="array",n.args=e});A.register("array",j),A.register("shortArray",r),A.register("smallArray",t),A.register("longArray",a),A.register("bytes",u);var z=A.together(i,function(n,e){n.namespace="object",n.args=e});A.register("object",z),A.pushPattern(function(n){if("object"==typeof n){if(n instanceof A)return;if(n instanceof Array)return;return z(n)}});var O=A.together(c,function(n,e){n.namespace="union",n.args=e});A.register("union",O);var $=A.together(o,function(n,e){n.namespace="enums",n.args=e});A.register("enums",$),A.stringBytes=p;var B=A.together(g,function(n,e){n.namespace="string",n.args=e});A.register("string",B),A.register("shortString",B("uint8")),A.register("smallString",B("uint16")),A.register("longString",B("uint32"));var U=A.together(y,function(n,e){n.namespace="cstring",n.args=e});A.register("cstring",U),A.register("pchar",U(null));var x=A.together(l,function(n,e){n.namespace="depend",n.args=e});A.register("depend",x),A.register("dependArray",m);var S=A.together(v,function(n,e){n.namespace="exit",n.args=e});A.register("exit",S);var I=A.together(h,function(n,e){n.namespace="parse",n.args=e});A.register("parse",I);var D=A.together(k,function(n,e){n.namespace="virtual",n.args=e});A.register("virtual",D);var C=A.together(d,function(n,e){n.namespace="link",n.args=e});A.register("link",C),A.register("linkArray",w);var F=A.together(b,function(n,e){n.namespace="merge",n.args=e});return A.register("merge",F),A}var t=r();t.create=r;var a=t;"function"==typeof define?(define.amd||define.cmd)&&define(function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:window[n]=a}("jpacks");